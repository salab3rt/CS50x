{% extends "layout.html" %}

{% block title %}
    Sell
{% endblock %}

{% block main %}
<script type="text/javascript" src="static/sell.js"></script>
<script>var usr_stock = {{usr_stock | tojson}};</script>
        <form action="/sell" method="post">
          <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
              <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                <div class="card text-white" style="border-radius: 1rem;">
                  <div class="card-body text-center" id="card">
                    <div class="mb-md- mt-md-4">
                      <h2 class="fw-bold mb-2 text-uppercase">Sell</h2>
                      <p class="text-white-50 mb-4 list">Please enter stocks you want to sell!</p>
                      <h5 class="list" style="text-align: right;">Cash: {{cash | usd}}</h5>
                      <div class="form-outline form-white mb-4">
                        <select class="form-control form-control-lg" style="" name="symbol" id="inputform1" placeholder="Stock's Symbol" />
                          <option value="None" class="dropdown-menu-dark">Select stocks</option>
                          {% for row in usr_stock %}
                            {% set symb = row["symbol"] %}
                            {% if row["quantity"] > 0 %}
                              <option value="{{symb | upper}}" id="symb" class="uppercase dropdown-menu-dark">{{row["symbol"]}}</option>
                            {% endif %}
                          {% endfor%}
                        </select>
                        <br>
                        <input class="form-range slider" type="range" min="1" value="1" max="1" style="" id="slider" name="shares" placeholder="Quantity" type="number">
                          <label for="customrange1" class="form-label" style="width: -webkit-fill-available; text-align: left;">Quantity: <span id="qty" class="fw-bold" style="font-size: x-large;"><script>slider(slider)</script></span></label>
                          <script>slider_maxv();</script><br>
                        <div class="container-fluid center-block" style="max-width: fit-content;">
                            {% if get_flashed_messages() %}
                            <div class="alert alert-warning mb-0 text-center list" role="alert">
                              {{ get_flashed_messages() | join(" ") }}
                            </div>
                            {% else %}
                            <div class="mb-0 text-center" role="alert">
                              <br>
                            </div>
                            {% endif %}
                            <br>
                        </div>
                            <button class="btn text-light btn-outline-light btn-lg px-5" id="btnusr" type="submit">SELL!</button>
                      </div>
                            {% if symb_hist %}
                            <div class="mb-auto me-auto">
                              <h5 class="text-muted list" style="text-align: left;">Recent activity:</h5>
                              <hr class="dropdown-divider height-3px">
                              {% for row in symb_hist %}
                                {% if row["action"] == 'BUY' %}
                                  <h4 class="list buy">{{row["action"]}} -- {{row["quantity"] | trim('-')}} {{row["symbol"]}} shares for {{row["cost"] | usd}} -- </h4>
                                {% else %}
                                  <h4 class="list sell">{{row["action"]}} -- {{row["quantity"] | trim('-')}} {{row["symbol"]}} shares for {{row["cost"] | usd}} -- </h4>
                                {% endif %}
                                <hr class="dropdown-divider">
                              {% endfor %}
                            </div>
                            {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>

{% endblock %}